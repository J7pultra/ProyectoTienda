<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{fragments/layout :: layout(~{::title}, ~{::main})}">
<head>
    <title th:text="'Cliente: ' + ${cliente.nombreCompleto} + ' - Boutique Uniformes'">Cliente - Boutique Uniformes</title>
</head>
<body>
    <main th:fragment="content" class="fade-in">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb bg-white rounded shadow-sm p-3">
                <li class="breadcrumb-item">
                    <a th:href="@{/dashboard}" class="text-decoration-none">
                        <i class="fas fa-home me-1"></i>Inicio
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <a th:href="@{/clientes}" class="text-decoration-none" th:text="#{nav.clientes}">Clientes</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page" th:text="${cliente.nombreCompleto}">Cliente</li>
            </ol>
        </nav>

        <!-- Header del cliente -->
        <div class="client-header mb-4">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <div class="d-flex align-items-center">
                        <div class="client-avatar me-4">
                            <div class="avatar-large bg-primary text-white">
                                <span th:text="${#strings.substring(cliente.nombre, 0, 1) + #strings.substring(cliente.apellido, 0, 1)}">AB</span>
                            </div>
                        </div>
                        <div>
                            <h1 class="client-name" th:text="${cliente.nombreCompleto}">Nombre Completo</h1>
                            <p class="client-info mb-1">
                                <i class="fas fa-id-card me-2"></i>
                                <span th:text="${cliente.documento}">Documento</span>
                            </p>
                            <p class="client-status mb-0">
                                <span th:if="${cliente.activo}" class="badge bg-success fs-6" th:text="#{status.activo}">Activo</span>
                                <span th:unless="${cliente.activo}" class="badge bg-danger fs-6" th:text="#{status.inactivo}">Inactivo</span>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-md-end">
                    <div class="btn-group" role="group">
                        <a th:href="@{/clientes/editar/{id}(id=${cliente.id})}" 
                           class="btn btn-primary" sec:authorize="hasAnyRole('ADMIN', 'EMPLEADO')">
                            <i class="fas fa-edit me-2"></i>
                            <span th:text="#{btn.editar}">Editar</span>
                        </a>
                        <a th:href="@{/ventas/nueva(clienteId=${cliente.id})}" 
                           class="btn btn-success" sec:authorize="hasAnyRole('ADMIN', 'VENDEDOR', 'EMPLEADO')">
                            <i class="fas fa-plus me-2"></i>
                            <span th:text="#{btn.nueva.venta}">Nueva Venta</span>
                        </a>
                        <a th:href="@{/clientes}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>
                            <span th:text="#{btn.volver}">Volver</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Información del cliente -->
        <div class="row mb-4">
            <!-- Información Personal -->
            <div class="col-lg-8">
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">
                            <i class="fas fa-user me-2"></i>
                            <span th:text="#{clientes.informacion.personal}">Información Personal</span>
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="detail-item mb-3">
                                    <label class="detail-label" th:text="#{form.nombre}">Nombre</label>
                                    <div class="detail-value" th:text="${cliente.nombre}">Nombre</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="detail-item mb-3">
                                    <label class="detail-label" th:text="#{form.apellido}">Apellido</label>
                                    <div class="detail-value" th:text="${cliente.apellido}">Apellido</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="detail-item mb-3">
                                    <label class="detail-label" th:text="#{form.documento}">Documento</label>
                                    <div class="detail-value font-monospace" th:text="${cliente.documento}">12345678</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="detail-item mb-3">
                                    <label class="detail-label" th:text="#{form.email}">Email</label>
                                    <div class="detail-value">
                                        <a th:if="${cliente.email}" th:href="'mailto:' + ${cliente.email}" 
                                           th:text="${cliente.email}" class="text-decoration-none">email@ejemplo.com</a>
                                        <span th:unless="${cliente.email}" class="text-muted">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="detail-item mb-3">
                                    <label class="detail-label" th:text="#{form.telefono}">Teléfono</label>
                                    <div class="detail-value">
                                        <a th:if="${cliente.telefono}" th:href="'tel:' + ${cliente.telefono}" 
                                           th:text="${cliente.telefono}" class="text-decoration-none">123-456-7890</a>
                                        <span th:unless="${cliente.telefono}" class="text-muted">-</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="detail-item mb-3">
                                    <label class="detail-label" th:text="#{form.ciudad}">Ciudad</label>
                                    <div class="detail-value" th:text="${cliente.ciudad ?: '-'}">Ciudad</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-item">
                            <label class="detail-label" th:text="#{form.direccion}">Dirección</label>
                            <div class="detail-value" th:text="${cliente.direccion ?: '-'}">Dirección completa</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Estadísticas del cliente -->
            <div class="col-lg-4">
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                                                <h6 class="m-0 font-weight-bold text-primary">
                            <i class="fas fa-chart-bar me-2"></i>
                            <span th:text="#{clientes.estadisticas}">Estadísticas del Cliente</span>
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="stat-item mb-3">
                            <div class="stat-icon bg-success">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number">$0</div>
                                <div class="stat-label" th:text="#{clientes.total.compras}">Total Compras</div>
                            </div>
                        </div>
                        
                        <div class="stat-item mb-3">
                            <div class="stat-icon bg-primary">
                                <i class="fas fa-receipt"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number">0</div>
                                <div class="stat-label" th:text="#{clientes.numero.compras}">Número de Compras</div>
                            </div>
                        </div>
                        
                        <div class="stat-item mb-3">
                            <div class="stat-icon bg-info">
                                <i class="fas fa-calendar"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number">-</div>
                                <div class="stat-label" th:text="#{clientes.ultima.compra}">Última Compra</div>
                            </div>
                        </div>
                        
                        <div class="stat-item">
                            <div class="stat-icon bg-warning">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" th:text="${#temporals.format(cliente.fechaRegistro, 'dd/MM/yyyy')}">01/01/2024</div>
                                <div class="stat-label" th:text="#{clientes.fecha.registro}">Fecha Registro</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Acciones rápidas -->
                <div class="card shadow">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">
                            <i class="fas fa-bolt me-2"></i>
                            <span th:text="#{clientes.acciones.rapidas}">Acciones Rápidas</span>
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a th:href="@{/ventas/nueva(clienteId=${cliente.id})}" 
                               class="btn btn-success" sec:authorize="hasAnyRole('ADMIN', 'VENDEDOR', 'EMPLEADO')">
                                <i class="fas fa-plus me-2"></i>
                                <span th:text="#{btn.nueva.venta}">Nueva Venta</span>
                            </a>
                            
                            <a th:href="@{/clientes/editar/{id}(id=${cliente.id})}" 
                               class="btn btn-primary" sec:authorize="hasAnyRole('ADMIN', 'EMPLEADO')">
                                <i class="fas fa-edit me-2"></i>
                                <span th:text="#{btn.editar.cliente}">Editar Cliente</span>
                            </a>
                            
                            <button type="button" class="btn btn-outline-info" onclick="enviarEmail()">
                                <i class="fas fa-envelope me-2"></i>
                                <span th:text="#{btn.enviar.email}">Enviar Email</span>
                            </button>
                            
                            <button type="button" class="btn btn-outline-secondary" onclick="exportarDatos()">
                                <i class="fas fa-download me-2"></i>
                                <span th:text="#{btn.exportar.datos}">Exportar Datos</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Historial de compras -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header py-3 d-flex justify-content-between align-items-center">
                        <h6 class="m-0 font-weight-bold text-primary">
                            <i class="fas fa-history me-2"></i>
                            <span th:text="#{clientes.historial.compras}">Historial de Compras</span>
                        </h6>
                        <a th:href="@{/ventas(clienteId=${cliente.id})}" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-eye me-1"></i>
                            <span th:text="#{btn.ver.todas}">Ver Todas</span>
                        </a>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th th:text="#{table.fecha}">Fecha</th>
                                        <th th:text="#{table.factura}">Factura</th>
                                        <th th:text="#{table.productos}">Productos</th>
                                        <th th:text="#{table.total}">Total</th>
                                        <th th:text="#{table.estado}">Estado</th>
                                        <th th:text="#{table.acciones}">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:if="${ventas == null or #lists.isEmpty(ventas)}">
                                        <td colspan="6" class="text-center py-5">
                                            <div class="empty-state">
                                                <i class="fas fa-shopping-cart fa-3x text-muted mb-3"></i>
                                                <h5 class="text-muted" th:text="#{clientes.sin.compras}">Sin compras registradas</h5>
                                                <p class="text-muted" th:text="#{clientes.sin.compras.descripcion}">
                                                    Este cliente aún no ha realizado ninguna compra.
                                                </p>
                                                <a th:href="@{/ventas/nueva(clienteId=${cliente.id})}" 
                                                   class="btn btn-success" sec:authorize="hasAnyRole('ADMIN', 'VENDEDOR', 'EMPLEADO')">
                                                    <i class="fas fa-plus me-2"></i>
                                                    <span th:text="#{btn.crear.primera.venta}">Crear Primera Venta</span>
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                    
                                    <!-- Datos de ejemplo si no hay ventas reales -->
                                    <tr th:unless="${ventas != null and not #lists.isEmpty(ventas)}">
                                        <td>Hoy, 14:30</td>
                                        <td><strong>FAC-001234</strong></td>
                                        <td>
                                            <div class="product-list">
                                                <span class="badge bg-light text-dark me-1">Camisa Escolar</span>
                                                <span class="badge bg-light text-dark me-1">Pantalón Azul</span>
                                                <span class="text-muted">+2 más</span>
                                            </div>
                                        </td>
                                        <td><strong class="text-success">$150.000</strong></td>
                                        <td><span class="badge bg-success">Completada</span></td>
                                        <td>
                                            <a href="#" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- CSS específico -->
    <th:block th:fragment="css">
        <style>
            .client-header {
                background: linear-gradient(135deg, rgba(79, 70, 229, 0.05) 0%, rgba(255, 255, 255, 0.95) 100%);
                border-radius: 15px;
                padding: 2rem;
                border: 1px solid rgba(79, 70, 229, 0.1);
            }
            
            .client-avatar {
                width: 80px;
                height: 80px;
            }
            
            .avatar-large {
                width: 100%;
                height: 100%;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 2rem;
                font-weight: 700;
                box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
            }
            
            .client-name {
                font-size: 2.25rem;
                font-weight: 700;
                color: #1e293b;
                margin-bottom: 0.5rem;
            }
            
            .client-info {
                color: #6b7280;
                font-size: 1.1rem;
            }
            
            .detail-item {
                border-bottom: 1px solid #f1f5f9;
                padding-bottom: 0.75rem;
            }
            
            .detail-item:last-child {
                border-bottom: none;
                padding-bottom: 0;
            }
            
            .detail-label {
                font-size: 0.875rem;
                font-weight: 600;
                color: #6b7280;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                margin-bottom: 0.25rem;
                display: block;
            }
            
            .detail-value {
                font-size: 1rem;
                color: #1e293b;
                font-weight: 500;
            }
            
            .stat-item {
                display: flex;
                align-items: center;
                padding: 1rem;
                background: #f8fafc;
                border-radius: 12px;
                transition: all 0.3s ease;
            }
            
            .stat-item:hover {
                background: #f1f5f9;
                transform: translateX(5px);
            }
            
            .stat-icon {
                width: 50px;
                height: 50px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                margin-right: 1rem;
                flex-shrink: 0;
            }
            
            .stat-content {
                flex: 1;
            }
            
            .stat-number {
                font-size: 1.5rem;
                font-weight: 700;
                color: #1e293b;
                margin-bottom: 0.25rem;
            }
            
            .stat-label {
                font-size: 0.875rem;
                color: #6b7280;
                text-transform: uppercase;
                letter-spacing: 0.05em;
            }
            
            .product-list {
                display: flex;
                flex-wrap: wrap;
                gap: 0.25rem;
            }
            
            .empty-state {
                padding: 3rem 2rem;
            }
            
            @media (max-width: 768px) {
                .client-name {
                    font-size: 1.75rem;
                }
                
                .client-header {
                    padding: 1.5rem;
                }
                
                .client-avatar {
                    width: 60px;
                    height: 60px;
                }
                
                .avatar-large {
                    font-size: 1.5rem;
                }
                
                .stat-item {
                    flex-direction: column;
                    text-align: center;
                }
                
                .stat-icon {
                    margin-right: 0;
                    margin-bottom: 0.75rem;
                }
            }
        </style>
    </th:block>

    <!-- JavaScript específico -->
    <th:block th:fragment="scripts">
        <script>
            function enviarEmail() {
                const email = /*[[${cliente.email}]]*/ '';
                
                if (!email) {
                    showNotification('Este cliente no tiene email registrado', 'warning');
                    return;
                }
                
                Swal.fire({
                    title: 'Enviar Email',
                    html: `
                        <div class="text-start">
                            <label for="emailSubject" class="form-label">Asunto:</label>
                            <input type="text" id="emailSubject" class="form-control mb-3" 
                                   placeholder="Asunto del email">
                            
                            <label for="emailMessage" class="form-label">Mensaje:</label>
                            <textarea id="emailMessage" class="form-control" rows="4" 
                                      placeholder="Escribe tu mensaje aquí..."></textarea>
                        </div>
                    `,
                    showCancelButton: true,
                    confirmButtonText: 'Enviar',
                    cancelButtonText: 'Cancelar',
                    preConfirm: () => {
                        const subject = document.getElementById('emailSubject').value;
                        const message = document.getElementById('emailMessage').value;
                        
                        if (!subject || !message) {
                            Swal.showValidationMessage('Por favor completa todos los campos');
                            return false;
                        }
                        
                        return { subject, message };
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Simular envío de email
                        showNotification('Email enviado exitosamente', 'success');
                    }
                });
            }
            
            function exportarDatos() {
                showNotification('Exportando datos del cliente...', 'info');
                
                setTimeout(() => {
                    showNotification('Datos exportados exitosamente', 'success');
                    // Aquí implementarías la descarga real
                    window.open(`/clientes/exportar/${/*[[${cliente.id}]]*/ 1}`, '_blank');
                }, 1500);
            }
            
            // Animaciones de entrada
            document.addEventListener('DOMContentLoaded', function() {
                const cards = document.querySelectorAll('.card');
                cards.forEach((card, index) => {
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px)';
                    
                    setTimeout(() => {
                        card.style.transition = 'all 0.6s ease';
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }, index * 100);
                });
                
                // Actualizar estadísticas del cliente
                loadClientStats();
            });
            
            function loadClientStats() {
                const clienteId = /*[[${cliente.id}]]*/ 1;
                
                // Simular carga de estadísticas
                fetch(`/api/clientes/${clienteId}/stats`)
                    .then(response => response.json())
                    .then(data => {
                        // Actualizar estadísticas en la interfaz
                        updateClientStats(data);
                    })
                    .catch(error => {
                        console.error('Error cargando estadísticas:', error);
                    });
            }
            
            function updateClientStats(stats) {
                // Actualizar valores en la interfaz
                const statNumbers = document.querySelectorAll('.stat-number');
                if (stats) {
                    // Aquí actualizarías los valores reales
                    console.log('Estadísticas del cliente:', stats);
                }
            }
        </script>
    </th:block>
</body>
</html>
