<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{fragments/layout :: layout(~{::title}, ~{::main})}">
<head>
    <title th:text="#{title.asistencias}">Control de Asistencias - Boutique Uniformes</title>
</head>
<body>
    <main th:fragment="content" class="fade-in">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb bg-white rounded shadow-sm p-3">
                <li class="breadcrumb-item">
                    <a th:href="@{/dashboard}" class="text-decoration-none">
                        <i class="fas fa-home me-1"></i>Inicio
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page" th:text="#{nav.asistencias}">Asistencias</li>
            </ol>
        </nav>

        <!-- Header de la página -->
        <div class="page-header mb-4">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="page-title">
                        <i class="fas fa-clock me-3 text-primary"></i>
                        <span th:text="#{title.asistencias}">Control de Asistencias</span>
                    </h1>
                    <p class="page-subtitle text-muted mb-0" th:text="#{asistencias.descripcion}">
                        Gestiona y controla la asistencia de todos los empleados
                    </p>
                </div>
                <div class="col-md-4 text-md-end">
                    <div class="btn-group" role="group">
                        <a th:href="@{/asistencias/nueva}" class="btn btn-success" 
                           sec:authorize="hasAnyRole('ADMIN', 'EMPLEADO')">
                            <i class="fas fa-plus me-2"></i>
                            <span th:text="#{btn.registrar.asistencia}">Registrar Asistencia</span>
                        </a>
                        <button type="button" class="btn btn-primary" onclick="marcarAsistenciaRapida()">
                            <i class="fas fa-user-check me-2"></i>
                            <span th:text="#{btn.marcar.rapido}">Marcar Rápido</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estadísticas del día -->
        <div class="row mb-4">
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="stat-card bg-success">
                    <div class="stat-icon">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" th:text="${presentesHoy ?: 0}">0</div>
                        <div class="stat-label" th:text="#{stat.presentes.hoy}">Presentes Hoy</div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="stat-card bg-danger">
                    <div class="stat-icon">
                        <i class="fas fa-user-times"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" th:text="${ausentesHoy ?: 0}">0</div>
                        <div class="stat-label" th:text="#{stat.ausentes.hoy}">Ausentes Hoy</div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="stat-card bg-warning">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" th:text="${tardanzasHoy ?: 0}">0</div>
                        <div class="stat-label" th:text="#{stat.tardanzas.hoy}">Tardanzas Hoy</div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="stat-card bg-info">
                    <div class="stat-icon">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" th:text="${porcentajeAsistencia ?: '0%'}">0%</div>
                        <div class="stat-label" th:text="#{stat.porcentaje.asistencia}">% Asistencia</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reloj y fecha actual -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm bg-gradient-primary text-white">
                    <div class="card-body text-center py-4">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <div class="current-time">
                                    <div class="time-display" id="currentTime">
                                        <span th:text="${#temporals.format(#temporals.createNow(), 'HH:mm:ss')}">10:30:45</span>
                                    </div>
                                    <div class="date-display">
                                        <span th:text="${#temporals.format(#temporals.createNow(), 'EEEE, dd MMMM yyyy')}">Lunes, 01 Enero 2024</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="attendance-summary">
                                    <h5 th:text="#{asistencias.resumen.dia}">Resumen del Día</h5>
                                    <p class="mb-0" th:text="#{asistencias.empleados.registrados}">
                                        <span th:text="${presentesHoy + ausentesHoy}">0</span> empleados registrados
                                    </p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="quick-actions">
                                    <button type="button" class="btn btn-light btn-sm me-2" onclick="exportarAsistencias()">
                                        <i class="fas fa-download me-1"></i>
                                        <span th:text="#{btn.exportar}">Exportar</span>
                                    </button>
                                    <button type="button" class="btn btn-outline-light btn-sm" onclick="imprimirReporte()">
                                        <i class="fas fa-print me-1"></i>
                                        <span th:text="#{btn.imprimir}">Imprimir</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filtros y búsqueda -->
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <form th:action="@{/asistencias}" method="get" class="row g-3">
                    <div class="col-md-3">
                        <label for="empleadoId" class="form-label" th:text="#{form.empleado}">Empleado</label>
                        <select class="form-select" id="empleadoId" name="empleadoId">
                            <option value="" th:text="#{filter.todos.empleados}">Todos los empleados</option>
                            <option th:each="emp : ${empleados}" th:value="${emp.id}" 
                                    th:text="${emp.nombreCompleto}" th:selected="${emp.id == empleadoId}">
                                Empleado
                            </option>
                        </select>
                    </div>
                    
                    <div class="col-md-2">
                        <label for="fechaInicio" class="form-label" th:text="#{form.fecha.inicio}">Fecha Inicio</label>
                        <input type="date" class="form-control" id="fechaInicio" name="fechaInicio" 
                               th:value="${fechaInicio}">
                    </div>
                    
                    <div class="col-md-2">
                        <label for="fechaFin" class="form-label" th:text="#{form.fecha.fin}">Fecha Fin</label>
                        <input type="date" class="form-control" id="fechaFin" name="fechaFin" 
                               th:value="${fechaFin}">
                    </div>
                    
                    <div class="col-md-2">
                        <label for="estado" class="form-label" th:text="#{form.estado}">Estado</label>
                        <select class="form-select" id="estado" name="estado">
                            <option value="" th:text="#{filter.todos}">Todos</option>
                            <option value="PRESENTE" th:selected="${estado == 'PRESENTE'}" th:text="#{status.presente}">Presente</option>
                            <option value="AUSENTE" th:selected="${estado == 'AUSENTE'}" th:text="#{status.ausente}">Ausente</option>
                            <option value="TARDANZA" th:selected="${estado == 'TARDANZA'}" th:text="#{status.tardanza}">Tardanza</option>
                            <option value="PERMISO" th:selected="${estado == 'PERMISO'}" th:text="#{status.permiso}">Permiso</option>
                        </select>
                    </div>
                    
                    <div class="col-md-2">
                        <label for="ordenar" class="form-label" th:text="#{form.ordenar}">Ordenar por</label>
                        <select class="form-select" id="ordenar" name="sortBy">
                            <option value="fecha" th:selected="${sortBy == 'fecha'}" th:text="#{sort.fecha}">Fecha</option>
                            <option value="empleado.nombre" th:selected="${sortBy == 'empleado.nombre'}" th:text="#{sort.empleado}">Empleado</option>
                            <option value="horaEntrada" th:selected="${sortBy == 'horaEntrada'}" th:text="#{sort.hora.entrada}">Hora Entrada</option>
                        </select>
                    </div>
                    
                    <div class="col-md-1 d-flex align-items-end">
                        <div class="btn-group w-100" role="group">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-search"></i>
                            </button>
                            <a th:href="@{/asistencias}" class="btn btn-outline-secondary">
                                <i class="fas fa-times"></i>
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tabla de asistencias -->
        <div class="card shadow">
            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                <h6 class="m-0 font-weight-bold text-primary">
                    <i class="fas fa-list me-2"></i>
                    <span th:text="#{asistencias.registro}">Registro de Asistencias</span>
                    <span class="badge bg-primary ms-2" th:text="${asistencias.totalElements}">0</span>
                </h6>
                
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-success btn-sm" onclick="exportarAsistencias()">
                        <i class="fas fa-file-excel me-1"></i>
                        <span th:text="#{btn.exportar}">Exportar</span>
                    </button>
                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="generarReporte()">
                        <i class="fas fa-chart-bar me-1"></i>
                        <span th:text="#{btn.reporte}">Reporte</span>
                    </button>
                </div>
            </div>
            
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0" id="asistenciasTable">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">
                                    <a th:href="@{/asistencias(sortBy='empleado.nombre', sortDir=${reverseSortDir})}" 
                                       class="text-decoration-none text-dark">
                                        <span th:text="#{table.empleado}">Empleado</span>
                                        <i class="fas fa-sort ms-1" th:if="${sortBy != 'empleado.nombre'}"></i>
                                        <i class="fas fa-sort-up ms-1" th:if="${sortBy == 'empleado.nombre' and sortDir == 'asc'}"></i>
                                        <i class="fas fa-sort-down ms-1" th:if="${sortBy == 'empleado.nombre' and sortDir == 'desc'}"></i>
                                    </a>
                                </th>
                                <th scope="col">
                                    <a th:href="@{/asistencias(sortBy='fecha', sortDir=${reverseSortDir})}" 
                                       class="text-decoration-none text-dark">
                                        <span th:text="#{table.fecha}">Fecha</span>
                                        <i class="fas fa-sort ms-1" th:if="${sortBy != 'fecha'}"></i>
                                        <i class="fas fa-sort-up ms-1" th:if="${sortBy == 'fecha' and sortDir == 'asc'}"></i>
                                        <i class="fas fa-sort-down ms-1" th:if="${sortBy == 'fecha' and sortDir == 'desc'}"></i>
                                    </a>
                                </th>
                                <th scope="col" th:text="#{table.hora.entrada}">Hora Entrada</th>
                                <th scope="col" th:text="#{table.hora.salida}">Hora Salida</th>
                                <th scope="col" th:text="#{table.horas.trabajadas}">Horas Trabajadas</th>
                                <th scope="col" th:text="#{table.estado}">Estado</th>
                                <th scope="col" th:text="#{table.observaciones}">Observaciones</th>
                                <th scope="col" class="text-center" th:text="#{table.acciones}">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:if="${asistencias.empty}">
                                <td colspan="8" class="text-center py-5">
                                    <div class="empty-state">
                                        <i class="fas fa-clock fa-3x text-muted mb-3"></i>
                                        <h5 class="text-muted" th:text="#{asistencias.no.encontradas}">No se encontraron registros</h5>
                                        <p class="text-muted" th:text="#{asistencias.no.encontradas.descripcion}">
                                            Intenta ajustar los filtros de búsqueda o registra una nueva asistencia.
                                        </p>
                                        <a th:href="@{/asistencias/nueva}" class="btn btn-success" 
                                           sec:authorize="hasAnyRole('ADMIN', 'EMPLEADO')">
                                            <i class="fas fa-plus me-2"></i>
                                            <span th:text="#{btn.registrar.asistencia}">Registrar Asistencia</span>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            
                            <tr th:each="asistencia : ${asistencias.content}" class="asistencia-row">
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-sm me-3">
                                            <div class="avatar-circle bg-primary text-white">
                                                <span th:text="${#strings.substring(asistencia.empleado.nombre, 0, 1) + #strings.substring(asistencia.empleado.apellido, 0, 1)}">AB</span>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="fw-bold" th:text="${asistencia.empleado.nombreCompleto}">Nombre Empleado</div>
                                            <small class="text-muted" th:text="${asistencia.empleado.cargo}">Cargo</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span th:text="${#temporals.format(asistencia.fecha, 'dd/MM/yyyy')}">01/01/2024</span>
                                    <br>
                                    <small class="text-muted" th:text="${#temporals.format(asistencia.fecha, 'EEEE')}">Lunes</small>
                                </td>
                                <td>
                                    <span th:if="${asistencia.horaEntrada}" 
                                          th:text="${#temporals.format(asistencia.horaEntrada, 'HH:mm')}" 
                                          class="badge bg-success">08:00</span>
                                    <span th:unless="${asistencia.horaEntrada}" class="text-muted">-</span>
                                </td>
                                <td>
                                    <span th:if="${asistencia.horaSalida}" 
                                          th:text="${#temporals.format(asistencia.horaSalida, 'HH:mm')}" 
                                          class="badge bg-info">17:00</span>
                                    <span th:unless="${asistencia.horaSalida}" class="text-muted">-</span>
                                </td>
                                <td>
                                    <span th:if="${asistencia.horaEntrada and asistencia.horaSalida}" 
                                          class="fw-bold">8h 00m</span>
                                    <span th:unless="${asistencia.horaEntrada and asistencia.horaSalida}" 
                                          class="text-muted">-</span>
                                </td>
                                <td>
                                    <span th:switch="${asistencia.estado}">
                                        <span th:case="'PRESENTE'" class="badge bg-success" th:text="#{status.presente}">Presente</span>
                                        <span th:case="'AUSENTE'" class="badge bg-danger" th:text="#{status.ausente}">Ausente</span>
                                        <span th:case="'TARDANZA'" class="badge bg-warning" th:text="#{status.tardanza}">Tardanza</span>
                                        <span th:case="'PERMISO'" class="badge bg-info" th:text="#{status.permiso}">Permiso</span>
                                    </span>
                                </td>
                                <td>
                                    <span th:if="${asistencia.observaciones}" 
                                          th:text="${#strings.abbreviate(asistencia.observaciones, 30)}" 
                                          th:title="${asistencia.observaciones}">Observaciones</span>
                                    <span th:unless="${asistencia.observaciones}" class="text-muted">-</span>
                                </td>
                                <td class="text-center">
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-outline-info btn-sm" 
                                                th:onclick="'verDetalle(' + ${asistencia.id} + ')'"
                                                th:title="#{btn.ver.detalle}">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-primary btn-sm" 
                                                th:onclick="'editarAsistencia(' + ${asistencia.id} + ')'"
                                                th:title="#{btn.editar}"
                                                sec:authorize="hasAnyRole('ADMIN', 'EMPLEADO')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm" 
                                                th:onclick="'marcarSalida(' + ${asistencia.id} + ')'"
                                                th:if="${asistencia.horaEntrada and !asistencia.horaSalida}"
                                                th:title="#{btn.marcar.salida}">
                                            <i class="fas fa-sign-out-alt"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Paginación -->
            <div class="card-footer" th:if="${asistencias.totalPages > 1}">
                <nav aria-label="Paginación de asistencias">
                    <ul class="pagination justify-content-center mb-0">
                        <li class="page-item" th:classappend="${asistencias.first} ? 'disabled'">
                            <a class="page-link" th:href="@{/asistencias(page=0, size=${asistencias.size}, sortBy=${sortBy}, sortDir=${sortDir})}">
                                <i class="fas fa-angle-double-left"></i>
                                <span th:text="#{page.primera}">Primera</span>
                            </a>
                        </li>
                        
                        <li class="page-item" th:classappend="${asistencias.first} ? 'disabled'">
                            <a class="page-link" th:href="@{/asistencias(page=${asistencias.number - 1}, size=${asistencias.size}, sortBy=${sortBy}, sortDir=${sortDir})}">
                                <i class="fas fa-angle-left"></i>
                                <span th:text="#{page.anterior}">Anterior</span>
                            </a>
                        </li>
                        
                        <li class="page-item" th:each="pageNum : ${#numbers.sequence(0, asistencias.totalPages - 1)}" 
                            th:if="${pageNum >= asistencias.number - 2 and pageNum <= asistencias.number + 2}"
                            th:classappend="${pageNum == asistencias.number} ? 'active'">
                            <a class="page-link" th:href="@{/asistencias(page=${pageNum}, size=${asistencias.size}, sortBy=${sortBy}, sortDir=${sortDir})}" 
                               th:text="${pageNum + 1}">1</a>
                        </li>
                        
                        <li class="page-item" th:classappend="${asistencias.last} ? 'disabled'">
                            <a class="page-link" th:href="@{/asistencias(page=${asistencias.number + 1}, size=${asistencias.size}, sortBy=${sortBy}, sortDir=${sortDir})}">
                                <span th:text="#{page.siguiente}">Siguiente</span>
                                <i class="fas fa-angle-right"></i>
                            </a>
                        </li>
                        
                        <li class="page-item" th:classappend="${asistencias.last} ? 'disabled'">
                            <a class="page-link" th:href="@{/asistencias(page=${asistencias.totalPages - 1}, size=${asistencias.size}, sortBy=${sortBy}, sortDir=${sortDir})}">
                                <span th:text="#{page.ultima}">Última</span>
                                <i class="fas fa-angle-double-right"></i>
                            </a>
                        </li>
                    </ul>
                </nav>
                
                <div class="text-center mt-3">
                    <small class="text-muted">
                        <span th:text="#{page.mostrando}">Mostrando</span>
                        <strong th:text="${asistencias.numberOfElements}">10</strong>
                        <span th:text="#{page.de}">de</span>
                        <strong th:text="${asistencias.totalElements}">100</strong>
                        <span th:text="#{page.registros}">registros</span>
                    </small>
                </div>
            </div>
        </div>
    </main>

    <!-- CSS específico -->
    <th:block th:fragment="css">
        <style>
            .page-header {
                background: linear-gradient(135deg, rgba(79, 70, 229, 0.05) 0%, rgba(255, 255, 255, 0.95) 100%);
                border-radius: 15px;
                padding: 2rem;
                border: 1px solid rgba(79, 70, 229, 0.1);
            }
            
            .page-title {
                font-size: 2.25rem;
                font-weight: 700;
                color: #1e293b;
                margin-bottom: 0.5rem;
            }
            
            .stat-card {
                background: white;
                border-radius: 15px;
                padding: 1.5rem;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                color: white;
            }
            
            .stat-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            }
            
            .stat-icon {
                font-size: 2.5rem;
                margin-right: 1.5rem;
                opacity: 0.8;
            }
            
            .stat-number {
                font-size: 2rem;
                font-weight: 700;
                margin-bottom: 0.25rem;
            }
            
            .stat-label {
                font-size: 0.875rem;
                opacity: 0.9;
                text-transform: uppercase;
                letter-spacing: 0.05em;
            }
            
            .current-time {
                text-align: center;
            }
            
            .time-display {
                font-size: 3rem;
                font-weight: 700;
                margin-bottom: 0.5rem;
                font-family: 'Courier New', monospace;
            }
            
            .date-display {
                font-size: 1.1rem;
                opacity: 0.9;
                text-transform: capitalize;
            }
            
            .attendance-summary {
                text-align: center;
                border-left: 1px solid rgba(255, 255, 255, 0.3);
                border-right: 1px solid rgba(255, 255, 255, 0.3);
                padding: 0 2rem;
            }
            
            .quick-actions {
                text-align: center;
            }
            
            .avatar-sm {
                width: 40px;
                height: 40px;
            }
            
            .avatar-circle {
                width: 100%;
                height: 100%;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: 600;
                font-size: 0.875rem;
            }
            
            .asistencia-row {
                transition: all 0.2s ease;
            }
            
            .asistencia-row:hover {
                background-color: rgba(79, 70, 229, 0.02);
                transform: translateX(2px);
            }
            
            .empty-state {
                padding: 3rem 2rem;
            }
            
            .table th {
                border-top: none;
                font-weight: 600;
                color: #374151;
                background-color: #f8fafc;
                padding: 1rem 0.75rem;
            }
            
            .table td {
                padding: 1rem 0.75rem;
                vertical-align: middle;
                border-color: #f1f5f9;
            }
            
            .btn-group .btn {
                border-radius: 6px;
                margin: 0 1px;
            }
            
            .bg-gradient-primary {
                background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            }
            
            @media (max-width: 768px) {
                .page-title {
                    font-size: 1.75rem;
                }
                
                .stat-card {
                    flex-direction: column;
                    text-align: center;
                }
                
                .stat-icon {
                    margin-right: 0;
                    margin-bottom: 1rem;
                }
                
                .time-display {
                    font-size: 2rem;
                }
                
                .attendance-summary {
                    border: none;
                    padding: 1rem 0;
                }
                
                .table-responsive {
                    font-size: 0.875rem;
                }
                
                .btn-group {
                    flex-direction: column;
                }
                
                .btn-group .btn {
                    margin: 1px 0;
                }
            }
        </style>
    </th:block>

    <!-- JavaScript específico -->
    <th:block th:fragment="scripts">
        <script>
            // Actualizar reloj en tiempo real
            function updateClock() {
                const now = new Date();
                const timeElement = document.getElementById('currentTime');
                if (timeElement) {
                    timeElement.textContent = now.toLocaleTimeString('es-ES');
                }
            }
            
            // Actualizar cada segundo
            setInterval(updateClock, 1000);
            
            function marcarAsistenciaRapida() {
                Swal.fire({
                    title: 'Marcar Asistencia Rápida',
                    html: `
                        <div class="text-start">
                            <label for="empleadoSelect" class="form-label">Seleccionar Empleado:</label>
                            <select id="empleadoSelect" class="form-select mb-3">
                                <option value="">Seleccionar empleado...</option>
                                <!-- Aquí cargarías los empleados dinámicamente -->
                            </select>
                            
                            <label for="tipoMarca" class="form-label">Tipo de Marca:</label>
                            <select id="tipoMarca" class="form-select">
                                <option value="entrada">Entrada</option>
                                <option value="salida">Salida</option>
                            </select>
                        </div>
                    `,
                    showCancelButton: true,
                    confirmButtonText: 'Marcar',
                    cancelButtonText: 'Cancelar',
                    preConfirm: () => {
                        const empleado = document.getElementById('empleadoSelect').value;
                        const tipo = document.getElementById('tipoMarca').value;
                        
                        if (!empleado) {
                            Swal.showValidationMessage('Por favor selecciona un empleado');
                            return false;
                        }
                        
                        return { empleado, tipo };
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Simular marcado de asistencia
                        showNotification('Asistencia marcada exitosamente', 'success');
                        setTimeout(() => location.reload(), 1000);
                    }
                });
                
                // Cargar empleados en el select
                loadEmpleadosForQuickMark();
            }
            
            function loadEmpleadosForQuickMark() {
                fetch('/api/empleados/activos')
                    .then(response => response.json())
                    .then(empleados => {
                        const select = document.getElementById('empleadoSelect');
                        empleados.forEach(emp => {
                            const option = document.createElement('option');
                            option.value = emp.id;
                            option.textContent = emp.nombreCompleto;
                            select.appendChild(option);
                        });
                    })
                    .catch(error => {
                        console.error('Error cargando empleados:', error);
                    });
            }
            
            function verDetalle(id) {
                // Implementar vista de detalle
                window.location.href = `/asistencias/ver/${id}`;
            }
            
            function editarAsistencia(id) {
                // Implementar edición
                window.location.href = `/asistencias/editar/${id}`;
            }
            
            function marcarSalida(id) {
                Swal.fire({
                    title: '¿Marcar salida?',
                    text: 'Se registrará la hora actual como hora de salida',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'Sí, marcar salida',
                    cancelButtonText: 'Cancelar'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Crear formulario para envío POST
                        const form = document.createElement('form');
                        form.method = 'POST';
                        form.action = `/asistencias/marcar-salida/${id}`;
                        
                        document.body.appendChild(form);
                        form.submit();
                    }
                });
            }
            
            function exportarAsistencias() {
                showNotification('Exportando asistencias...', 'info');
                
                setTimeout(() => {
                    showNotification('Asistencias exportadas exitosamente', 'success');
                    window.open('/asistencias/exportar', '_blank');
                }, 1500);
            }
            
            function generarReporte() {
                showNotification('Generando reporte...', 'info');
                
                setTimeout(() => {
                    showNotification('Reporte generado exitosamente', 'success');
                    window.open('/asistencias/reporte', '_blank');
                }, 2000);
            }
            
            function imprimirReporte() {
                window.print();
            }
            
            // Inicializar cuando el DOM esté listo
            document.addEventListener('DOMContentLoaded', function() {
                // Animaciones de entrada
                const rows = document.querySelectorAll('.asistencia-row');
                rows.forEach((row, index) => {
                    row.style.opacity = '0';
                    row.style.transform = 'translateY(20px)';
                    
                    setTimeout(() => {
                        row.style.transition = 'all 0.4s ease';
                        row.style.opacity = '1';
                        row.style.transform = 'translateY(0)';
                    }, index * 50);
                });
                
                // Configurar fechas por defecto en filtros
                const today = new Date();
                const fechaInicio = document.getElementById('fechaInicio');
                const fechaFin = document.getElementById('fechaFin');
                
                if (!fechaInicio.value) {
                    fechaInicio.value = today.toISOString().split('T')[0];
                }
                if (!fechaFin.value) {
                    fechaFin.value = today.toISOString().split('T')[0];
                }
            });
        </script>
    </th:block>
</body>
</html>
